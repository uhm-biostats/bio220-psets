---
title: "Problem Set 01"
date: "Due Monday, Aug 28, 2023 @ 1:30 PM HST"
output:
  html_document: 
    toc: true
    toc_depth: 2
    number_sections: false
    theme: flatly
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, eval = TRUE, message = FALSE, warning = FALSE)

source("../r/header.R")
library(cowplot)
library(dplyr)
library(ggplot2)
library(magrittr)
library(readr)
library(readxl)
library(stringr)
library(tidyr)

```

Submit your answers using the Google Form on Laulima.

# Estimating the length of Hawai‘i's coasts

![](../img/hawaii.png)
Source: Google Maps

The table below summarizes the results from our group activity prior to the lab on Wednesday. Each group (A-J) estimated the length of the coastline in km for each of the 8 main Hawaiian Islands. The error for each estimate is reported here. A positive error means the group overestimated the coastline length. 

```{r, eval = FALSE}

# code from 2021
coastlines <- read_excel("lab1_coastlines.xlsx") %>%
  pivot_longer(-Group)

estimates <- filter(coastlines, Group != "Truth")
truth <- filter(coastlines, Group == "Truth") 

right_join(estimates, select(truth, -Group), by = "name") %>%
  transmute(Group, Island = name, value = value.x - value.y) %>%
  bind_rows(rename(truth, Island = name)) %>%
  pivot_wider(names_from = Island, values_from = value) %>%
  mutate(`Avg. abs. error` =  (abs(Ni) + abs(Ka...3) + abs(Oa) + abs(Mo) + abs(Ma) + abs(La) + abs(Ka...8) + abs(Ha)) / 8) %>%
  mutate_if(is.numeric, round) %>%
  mutate_if(is.numeric, ~ {str_c("+", .x)}) %>%
  mutate_if(is.character, ~ {str_replace(.x, "\\+-", "-")}) %>%
  # mutate_if(is.numeric, as.character) %>%
  rename(
    `Ni‘ihau` = Ni, `Kaua‘i` = Ka...3, `O‘ahu` = Oa, `Moloka‘i` = Mo, Maui = Ma, `Lāna‘i` = La, `Kaho‘olawe` = Ka...8, `Hawai‘i` = Ha    
  ) %>%
  mutate(`Avg. abs. error` = ifelse(Group != "Truth", `Avg. abs. error`, "")) %>%
  pivot_longer(-Group) %>%
  # filter(Group == "Truth") %>%
  # mutate(test = ifelse(Group == "Truth", str_remove(value, "\\+"), value))
  mutate(value = ifelse(Group == "Truth", str_remove(value, "\\+"), value)) %>%
  pivot_wider() %>%
  mutate(`Avg. abs. error` = str_remove(`Avg. abs. error` , "\\+")) %>%
  knitr::kable()

```

```{r}

# code from 2022
coastline_km = c(45, 220, 180, 142, 193, 76, 47, 429)
coastline_estimates = read_csv("../activities/2022-01-13-coastlines.csv") |>
  mutate(across(group_a:group_j, function(.x) .x - coastline_km))

knitr::kable(coastline_estimates)

```

The actual coastline length in km is given in the table below^[Data from: http://www.soest.hawaii.edu/coasts/data/].

```{r}
coastline_km |>
  matrix(ncol = 8) |>
  magrittr::set_colnames(c("Ni‘ihau", "Kaua‘i", "O‘ahu", "Moloka‘i", "Maui", "Lāna‘i", "Kaho‘olawe", "Hawai‘i")) |>
  knitr::kable()
```

Use the two summary tables below to help answer questions 1 & 2. The first table is the average absolute error ("Avg. abs. error") for each group, which is the arithmetic means of the absolute error values. The second table is the average error (not absolute value) for each island.

```{r}

coastline_estimates |>
  pivot_longer(-island) |>
  mutate(abs_value = abs(value)) |>
  group_by(name) |>
  summarise(`Avg. abs. error` = mean(abs_value)) |>
  knitr::kable()

```

```{r}

coastline_estimates |>
  pivot_longer(-island) |>
  group_by(island) |>
  summarise(`Avg. error` = mean(value)) |>
  mutate(island = case_when(
    island == "Ni" ~ "1. Ni‘ihau", 
    island == "Ka" ~ "2. Kaua‘i`", 
    island == "Oa" ~ "3. O‘ahu",
    island == "Mo" ~ "4. Moloka‘i",
    island == "Ma" ~ "5. Maui",
    island == "La" ~ "6. Lāna‘i",
    island == "Ka" ~ "7. Kaho‘olawe",
    island == "Ha" ~ "8. Hawai‘i"
  )) |>
  arrange(island) |>
  knitr::kable()

```

<div class="panel panel-info">
  <div class="panel-heading">Use the table above to answer questions 1 & 2</div>
  
  <div class="panel-body">

1. Which group's estimates were most *precise* on average? [1]

2. For which island were estimates the most *biased*? [1]

  </div>

</div>

# Random sampling for a clinical trial

Suppose you are designing a clinical trial for a new drug and you have enough budget to afford a trial with 100 participants randomly selected from the total (finite) population of adults living in the fictional country of El Dorado. Assume no one is added or subtracted (dies) from the population during sampling. El Dorado is divided into 10 regions that vary widely in their population size. To randomly select participants, you are given a list of all living adults in El Dorado arranged by Region and alphabetically by surname (last name) within Region like this:

 Region | Name        | ID Number |
--------|-------------|-----------|
 A      | Aaronson, A | 1         |
 $\vdots$ | $\vdots$  | $\vdots$  |
 A      | Zykowski, Z | 65184     |
 B      | Aaronson, A | 65185     |
 $\vdots$ | $\vdots$  | $\vdots$  |
 B      | Zykowski, Z | 187706    |
 C      | Aaronson, A | 187707    |
 $\vdots$ | $\vdots$  | $\vdots$  |
 C      | Zykowski, Z | 245906    |

Each adult also has unique ID Number determined by their Region and Name.

<div class="panel panel-info">
  <div class="panel-heading">Consider the following four sampling procedures to select participants, then answer questions 3 & 4</div>
  
  <div class="panel-body">

A. Choose the first 100 individuals in the list

B. Choose the first 10 individuals from each Region

C. Use a random number generator to select 10 ID Numbers from each region

D. Use a random number generator to select 100 ID Numbers from the country population

3. Which of the sampling procedures (A, B, C, or D) below is most likely to produce a *biased* estimate of the true population response to the drug? [1]

4. This question refers to the design of clinical trial in El Dorado from Question 3. After starting the trial on participants, you learn that a technician accidentally used a nonrandom sampling procedure that is likely to the bias your estimate. The technician suggests that you ask for more funding to increase the sample size to 200 while continuing to use the same biased sampling procedure If you adopt their suggestion, what is most likely true about the resulting estimate from the sample of 200? [1]

A. More precise and less biased

B. More precise and equally biased

C. Less precise and less biased

D. Less precise and equally biased

  </div>

</div>

# Laysan Albatross on O‘ahu

![](../img/Laysan_Albatross_RWD2.jpeg)
Photo credit: DickDaniels (http://carolinabirds.org/)

Scientists at [Pacific Rim Conservation](https://pacificrimconservation.org/) studied the population of Laysan Albatross (*Phoebastria immutabilis*) on O‘ahu (VanderWerf \& Young 2016)^[Link to original study: https://doi.org/10.1650/CONDOR-16-49.1]. Albatross remain at sea for a year or more after fledging but return to their birthplace to breed on land. 

<div class="panel panel-info">
  <div class="panel-heading">Question 5 & 6 refer to the prompt above.</div>
  
  <div class="panel-body">

5. Which of the figures below (**a.** or **b.**) shows the probability distribution for the age at first breeding in the population? Note that these figures use simulated data based on the actual study. [1]

```{r, albatross, fig.align='center', fig.width=7, fig.height=3.5}

set.seed(20211210)
df1 <- tibble(
  x = rnorm(100)
) %>%
  mutate(x = x + 8.44 - mean(x))

gp1 <- ggplot(df1, aes(x)) +
  geom_histogram(fill = "steelblue", color = "grey", binwidth = 0.5) +
  xlab("Age at first breeding (years)") +
  ylab("Frequency") +
  geom_vline(xintercept = 8.44, linetype = "dashed") +
  annotate("label", x = 8.44, y = 25, label = "Mean: 8.44 years") +
  theme_cowplot()

df2 <- tibble(
  x = seq(5, 12, 0.01),
  y = dnorm(x, 9, 1)
)

gp2 <- ggplot(df2, aes(x, y)) +
  geom_area(fill = "steelblue", color = "grey") +
  xlab("Age at first breeding (years)") +
  ylab("Probability density") +
  geom_vline(xintercept = 9, linetype = "dashed") +
  annotate("label", x = 9, y = 1.1 * dnorm(0), label = "Mean: 9 years") +
  theme_cowplot()

plot_grid(gp1, gp2, nrow = 1, labels = "auto")
  
```

6. TRUE or FALSE. Based on the figures above, the estimated mean age at first breeding for this population is 8.44 years. [1]

* TRUE
* FALSE

  </div>

</div>

# Randomly assign individuals to "treatments"

<div class="panel panel-info">
  <div class="panel-heading">Randomly assign students to project groups.</div>
  
  <div class="panel-body">

7. As discussed in the Syllabus, the Group Project is a major part of this class. The class will be divided into 10 evenly sized groups. For this activity, you will **randomly assign students to groups**. Each student must be assigned to one and only one group. Use the class roster located at the bottom of the problem set.

You can assign groups any way you want, as long as it is truly random. You need to upload your assignments and show how your randomization procedure works. This could be any of the following: 

* a scanned piece of paper showing randomization
* a Google Sheet/Doc with randomization procedure
* a short video describing and showing your randomization procedure
* an *R* script
* something else, as long as it's clear what you did. 

**You cannot just send the name of students in each group; you must show your randomization procedure.**

This question is worth [2] points.

  </div>

</div>

# Fix this spreadsheet!

The spreadsheet below is a small portion of an actual data set used in an analysis of speciation in fruit flies (*Drosophila* sp.).

![](../img/ps01-q08.png)


<div class="panel panel-info">
  <div class="panel-heading">Fix this spreadsheet!</div>
  
  <div class="panel-body">

8. Use the principles outlined in this week's reading by Broman & Woo (2018) to organize these data properly into a spreadsheet. Download the spreadsheet using the link below and save a copy replacing "STUDENTID" with your student ID.

https://docs.google.com/spreadsheets/d/1aGafJe2EGqgICUdLhDxfL4eEM_fK0yK6/edit?usp=sharing&ouid=112071956568067162902&rtpof=true&sd=true

You should put the organized data into a spreadsheet under the "fixed" sheet. When you're done, upload the file using the Google Form.

 * Consistent codes for categorical variables
 * Uses `NA` for missing data where applicable
 * Consistent variable names
 * Consistent subject identifiers
 * Dates written in YYYY-MM-DD format
 * No leading or trailing white space
 * No empty cells
 * One item per cell
 * Data are rectangular
 * No calculations in raw data file
 * No font color or highlighting as data

Note that not all criteria necessarily apply to these data and some criteria may already be met and do not need to be fixed. Here is some helpful information about the variables:

* `Sp 1` and `Sp 2` are species names for some fruit flies in the genus *Drosophila*
* `allop.` means that species 1 and 2 are allopatric (no range overlap)
* `symp.` means that species 1 and 2 are sympatric (some range overlap)
* `Nei's D` is a measure of genetic distance. Greater distance means there are more genetic differences between species
* `Premating Isol.` is the amount of premating reproductive isolation between species (0 is low, 1 is high)
* `Postz. hybrid fitness` is the postzygotic hybrid fitness. Are hybrids fertile, sterile, or none (hybrids not formed because species never mate)

This question is worth [2] points.

9a. Which of the following is a *categorical* variable.

9b. Which of the following is a *numerical* variable.

9c. Which of the following is a *ordinal* variable.

* `Sp 1`
* `allop. = 0 / symp. = 1`
* `Genetic Distance (Nei's D)`
* `Postz. hybrid fitness`

Question 9a-c is worth [1] point in total.

  </div>

</div>

# Class Roster

Use the class roster to randomly assign individuals to 10 project groups. Use buttons to copy-and-names, print, or save to .csv file.

```{r roster}

read_csv("../roster-2023-8-20.csv") %>%
  select(Name) %>%
  DT::datatable(extensions = 'Buttons', width = 300,
    options = list(
pageLength = 43,      dom = 'Bfrtip',
      buttons = c('copy', 'print', "csv")
  )
)
  # knitr::kable()

```
